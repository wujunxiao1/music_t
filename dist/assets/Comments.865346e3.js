import{U as R,K as T,w as E,h as l,j as i,k as t,I as m,a as n,q as H,ad as U,$ as _,z as r,m as d,ae as q,Z as B,c as S,o as K,af as W,Y as X,G as V,H as N,B as M,x as Y,y as Z,l as Q,T as ee,V as te,W as se,X as oe,ag as ne,M as ae}from"./index.d80bb040.js";const ce={class:"reply-comment"},me={class:"comment_textarea"},le={class:"pre"},ie={class:"comment_box_footer"},re={class:"comment_limit"},de={class:"num"},_e=_("\u8BC4\u8BBA"),ue={props:{params:Object},emits:["replyMsg"],setup(p,{emit:h}){const o=T({msg:"",maxLen:140}),e=()=>{h("replyMsg",o.msg)};return E(()=>o.msg,()=>{o.msg=o.maxLen>=o.msg?o.msg:o.msg.substring(0,o.maxLen)}),(x,y)=>{const v=q;return l(),i("div",ce,[t("h3",null,"\u6211\u56DE\u590D@"+m(p.params.user.nickname)+":",1),t("div",me,[t("div",le,m(n(o).msg),1),H(t("textarea",{class:"J_inpBox inp-paragraph",name:"leave_msg",id:"leave_msg",placeholder:"\u671F\u5F85\u4F60\u7684\u795E\u8BC4\u8BBA\u2026\u2026","onUpdate:modelValue":y[0]||(y[0]=f=>n(o).msg=f)},null,512),[[U,n(o).msg]])]),t("div",ie,[t("span",re,[t("em",de,m(n(o).msg.length),1),_("/"+m(n(o).maxLen),1)]),r(v,{type:"primary",onClick:e},{default:d(()=>[_e]),_:1})])])}}};var pe=R(ue,[["__scopeId","data-v-2eb40348"]]);const u=p=>(te("data-v-71b7912f"),p=p(),se(),p),he={class:"comments"},ge={class:"comment_hd"},fe=_("\u8BC4\u8BBA"),ye={class:"userInfo"},ve=u(()=>t("div",{slot:"placeholder",class:"image-slot"},[t("i",{class:"iconfont icon-placeholder"})],-1)),Ie={class:"comment_textarea"},Ce={class:"pre"},ke={class:"comment_box_footer"},xe=_("\u8BC4\u8BBA"),be={class:"comment_limit"},$e={class:"num"},Le={class:"comment_area"},we=u(()=>t("div",{slot:"placeholder",class:"image-slot"},[t("i",{class:"iconfont icon-placeholder"})],-1)),Be={class:"comment_info"},Se={class:"comment_content"},Ve={class:"comment_footer"},Me={class:"comment_time"},Ee={class:"comment_oper"},De=["onClick"],Ne=u(()=>t("i",{class:"iconfont icon-del"},null,-1)),Re=[Ne],Te=["onClick"],He=u(()=>t("i",{class:"iconfont icon-praise"},null,-1)),Ue=["onClick"],qe=u(()=>t("i",{class:"iconfont icon-comment"},null,-1)),je=[qe],ze={key:0,class:"isHot"},Fe=u(()=>t("i",{class:"iconfont icon-hot"},null,-1)),Je=[Fe],Oe={class:"pagination"},Pe={key:1,class:"comments_status"},Ae={key:0,class:"loading"},Ge={key:1,class:"empty"},Ke=u(()=>t("p",null,[t("i",{class:"iconfont icon-empty-main"})],-1)),We=u(()=>t("p",null,"\u6682\u65E0\u7559\u8A00",-1)),Xe=[Ke,We],Ye={props:{sId:{type:[Number,String],default:0},type:{type:Number,default:0}},setup(p){const h=p,{proxy:o}=ae(),e=T({msg:"",maxLen:140,curId:h.sId,limit:20,offset:0,before:0,hotComments:[],comments:[],total:0,currentPage:0,isEmpty:!1,replyCommentId:0,replyIndex:-1}),x=B.loginDialogStore(),y=B.accountInfoStore(),v=S(()=>y.getLogin),f=S(()=>y.getAccountInfo),j=S(()=>function(s,c){return s.commentId===e.replyCommentId&&e.replyIndex===c}),I=()=>{switch(e.isEmpty=!1,h.type){case 0:C("commentSong");break;case 1:C("commentMv");break;case 3:C("albumComment");break;case 5:C("commentVideo");break}},C=async s=>{const{data:c}=await o.$http[s]({id:e.curId,limit:e.limit,offset:e.offset,before:e.before,timestamp:new Date().valueOf()});z(c)},z=s=>{if(s.code!==200)return o.$msg.error("\u6570\u636E\u8BF7\u6C42\u5931\u8D25");e.total=s.total,e.hotComments=s.hotComments||[],e.hotComments.map(c=>(c.isHot=!0,c)),e.comments=[...e.hotComments,...s.comments],e.isEmpty=e.before===0&&!e.comments.length},F=s=>{o.$msgBox.confirm("\u786E\u5B9A\u5220\u9664\u8BC4\u8BBA\uFF1F","\u63D0\u793A",{confirmButtonText:"\u786E\u5B9A",cancelButtonText:"\u53D6\u6D88",center:!0}).then(()=>{D(0,"",s.commentId)}).catch(()=>{})},J=async s=>{if(!v.value){B.commit("setLoginDialog",!0);return}const{data:c}=await o.$http.commentLike({id:e.curId,cid:s.commentId,t:Number(!s.liked),type:h.type});if(c.code!==200)return o.$msg.error("\u6570\u636E\u8BF7\u6C42\u5931\u8D25");I()},D=async(s,c,k)=>{const b={t:s,type:h.type,id:e.curId,content:c,commentId:k},{data:$}=await o.$http.comment(b);if($.code!==200)return o.$msg.error("\u6570\u636E\u8BF7\u6C42\u5931\u8D25");e.msg="",I(),s===0?o.$msg.success("\u5220\u9664\u8BC4\u8BBA\u6210\u529F\uFF01"):s===1?o.$msg.success("\u8BC4\u8BBA\u6210\u529F\uFF01"):s===2&&(o.$msg.success("\u56DE\u590D\u8BC4\u8BBA\u6210\u529F\uFF01"),e.replyCommentId=0,e.replyIndex=-1)},O=(s,c)=>{if(!v){x.loginDialogVisible=!0;return}e.replyCommentId=e.replyCommentId===s.commentId&&e.replyIndex===c?0:s.commentId,e.replyIndex=c},P=s=>{if(!v){x.loginDialogVisible=!0;return}D(2,s,e.replyCommentId)},A=s=>{e.offset=(s-1)*e.limit,I()};return K(()=>{I()}),E(()=>h.sId,(s,c)=>{e.curId=s,e.offset=0,I()}),E(()=>e.msg,()=>{e.msg=e.maxLen>=e.msg?e.msg:e.msg.substring(0,e.maxLen)}),(s,c)=>{const k=oe,b=q,$=W,L=X("router-link"),G=ne;return l(),i("div",he,[t("div",ge,[t("h2",null,[fe,t("em",null,"\u5171"+m(n(e).total)+"\u6761\u8BC4\u8BBA",1)]),t("div",ye,[t("span",null,m(n(f).nickname),1),r(k,{src:n(f).avatarUrl,class:"avatar"},{default:d(()=>[ve]),_:1},8,["src"])])]),r($,{class:"comment_box"},{default:d(()=>[t("div",Ie,[t("div",Ce,m(n(e).msg),1),H(t("textarea",{class:"J_inpBox inp-paragraph",name:"leave_msg",id:"leave_msg",placeholder:"\u671F\u5F85\u4F60\u7684\u795E\u8BC4\u8BBA\u2026\u2026","onUpdate:modelValue":c[0]||(c[0]=a=>n(e).msg=a)},null,512),[[U,n(e).msg]])]),t("div",ke,[r(b,{type:"primary"},{default:d(()=>[xe]),_:1}),t("span",be,[t("em",$e,m(n(e).msg.length),1),_("/"+m(n(e).maxLen),1)])])]),_:1}),t("div",Le,[n(e).comments.length?(l(),i(V,{key:0},[(l(!0),i(V,null,N(n(e).comments,(a,w)=>(l(),i("div",{class:"comment_item",key:a.commentId+w+""},[r(L,{to:{path:"/home",query:{id:a.user.userId}},class:"comment_avatar"},{default:d(()=>[r(k,{src:a.user.avatarUrl+"?param=120y120"},{default:d(()=>[we]),_:2},1032,["src"])]),_:2},1032,["to"]),t("div",Be,[r(L,{to:{path:"/home",query:{id:a.user.userId}}},{default:d(()=>[_(m(a.user.nickname),1)]),_:2},1032,["to"]),t("div",Se,m(a.content),1),(l(!0),i(V,null,N(a.beReplied,g=>(l(),i("div",{class:"comment_reply",key:g.beRepliedCommentId},[r(L,{to:{path:"/home",query:{id:g.user.userId}}},{default:d(()=>[_(m(g.user.nickname),1)]),_:2},1032,["to"]),_(": "+m(g.content),1)]))),128)),t("div",Ve,[t("div",Me,m(s.$utils.formatMsgTime(a.time)),1),t("div",Ee,[n(f)&&n(f).userId===a.user.userId?(l(),i("em",{key:0,class:"comment_del",onClick:g=>F(a)},Re,8,De)):M("",!0),t("span",{class:Y([a.liked?"active":""]),onClick:g=>J(a)},[He,_("("+m(a.likedCount)+")",1)],10,Te),t("span",{class:"replyComment",onClick:Z(g=>O(a,w),["stop"])},je,8,Ue)])]),a.isHot?(l(),i("div",ze,Je)):M("",!0),r(ee,{name:"fade",mode:"out-in"},{default:d(()=>[n(j)(a,w)?(l(),Q(pe,{key:0,params:a,onReplyMsg:P},null,8,["params"])):M("",!0)]),_:2},1024)])]))),128)),t("div",Oe,[r(G,{onCurrentChange:A,layout:"prev, pager, next",total:n(e).total},null,8,["total"])])],64)):(l(),i("div",Pe,[n(e).isEmpty?(l(),i("div",Ge,Xe)):(l(),i("div",Ae,"\u8BC4\u8BBA\u52A0\u8F7D\u4E2D..."))]))])])}}};var Qe=R(Ye,[["__scopeId","data-v-71b7912f"]]);export{Qe as C};
